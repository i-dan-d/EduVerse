  <!DOCTYPE html>
<html lang="vi">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Game H·ªçc T·∫≠p - To√°n L√Ω H√≥a</title>
    <link rel="stylesheet" href="styles/main.css?v=2.1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="description" content="Game h·ªçc t·∫≠p To√°n, L√Ω, H√≥a cho h·ªçc sinh THCS v√† THPT">
    <meta name="keywords" content="game h·ªçc t·∫≠p, to√°n, l√Ω, h√≥a, thcs, thpt">
    
    <!-- PWA and Security -->
    <meta name="theme-color" content="#4F46E5">
    <meta name="robots" content="index, follow">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- Disable Chrome's password autofill warnings -->
    <meta name="google" content="notranslate">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    </head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>ƒêang t·∫£i game...</h2>
            <p>Chu·∫©n b·ªã tr·∫£i nghi·ªám h·ªçc t·∫≠p th√∫ v·ªã!</p>
        </div>
    </div>

    <!-- Header -->
    <header class="main-header">
        <nav class="navbar">
            <div class="nav-container">
                <!-- Logo -->
                <div class="nav-logo">
                    <i class="fas fa-atom"></i>
                    <span class="logo-text">EduVerse</span>
                </div>
                
                <!-- Desktop Menu -->
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="home.html" class="nav-link">
                            <i class="fas fa-home"></i>
                            <span>Trang ch·ªß</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="index.html" class="nav-link active">
                            <i class="fas fa-gamepad"></i>
                            <span>Game h·ªçc t·∫≠p</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="lab.html" class="nav-link">
                            <i class="fas fa-flask"></i>
                            <span>Ph√≤ng th√≠ nghi·ªám</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="research.html" class="nav-link">
                            <i class="fas fa-search"></i>
                            <span>Nghi√™n c·ª©u khoa h·ªçc</span>
                        </a>
                    </li>
                </ul>
                
                <!-- Mobile Menu Toggle -->
                <div class="mobile-menu-toggle">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </div>
            </div>
        </nav>
    </header>

    <!-- User Info Panel -->
    <div class="user-info-panel">
        <div class="container">
            <div class="user-info">
                <div class="score-display">
                    <i class="fas fa-star"></i>
                    <span id="totalScore">0</span>
                </div>
                <div class="level-display">
                    <i class="fas fa-trophy"></i>
                    <span id="currentLevel">1</span>
                </div>
                <div class="streak-display">
                    <i class="fas fa-fire"></i>
                    <span id="streakCount">0</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="screen active">
                <div class="welcome-content">
                    <div class="welcome-header">
                        <h2>Ch√†o m·ª´ng ƒë·∫øn v·ªõi Game H·ªçc T·∫≠p!</h2>
                        <p>Ch·ªçn m√¥n h·ªçc v√† c·∫•p ƒë·ªô ƒë·ªÉ b·∫Øt ƒë·∫ßu cu·ªôc phi√™u l∆∞u h·ªçc t·∫≠p</p>
                    </div>

                    <!-- Subject Selection -->
                    <div class="subject-selection">
                        <h3>Ch·ªçn m√¥n h·ªçc</h3>
                        <div class="subject-cards">
                            <div class="subject-card" data-subject="math">
                                <div class="subject-icon">
                                    <i class="fas fa-calculator"></i>
                                </div>
                                <h4>To√°n h·ªçc</h4>
                                <p>R√®n luy·ªán t∆∞ duy logic v√† t√≠nh to√°n</p>
                            </div>
                            <div class="subject-card" data-subject="physics">
                                <div class="subject-icon">
                                    <i class="fas fa-atom"></i>
                                </div>
                                <h4>V·∫≠t l√Ω</h4>
                                <p>Kh√°m ph√° th·∫ø gi·ªõi v·∫≠t ch·∫•t v√† nƒÉng l∆∞·ª£ng</p>
                            </div>
                            <div class="subject-card" data-subject="chemistry">
                                <div class="subject-icon">
                                    <i class="fas fa-flask"></i>
                                </div>
                                <h4>H√≥a h·ªçc</h4>
                                <p>T√¨m hi·ªÉu v·ªÅ c√°c ph·∫£n ·ª©ng h√≥a h·ªçc</p>
                            </div>
                        </div>
                    </div>

                    <!-- Level Selection -->
                    <div class="level-selection">
                        <h3>Ch·ªçn c·∫•p ƒë·ªô</h3>
                        <div class="level-buttons">
                            <button class="level-btn" data-level="thcs">
                                <i class="fas fa-graduation-cap"></i>
                                <span>THCS</span>
                                <small>L·ªõp 6-9</small>
                            </button>
                            <button class="level-btn" data-level="thpt">
                                <i class="fas fa-university"></i>
                                <span>THPT</span>
                                <small>L·ªõp 10-12</small>
                            </button>
                        </div>
                    </div>

                    <!-- Game Settings -->
                    <div class="game-settings">
                        <h3>‚öôÔ∏è C√†i ƒë·∫∑t game</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label for="questionCount">
                                    <i class="fas fa-question-circle"></i>
                                    S·ªë c√¢u h·ªèi:
                                </label>
                                <select id="questionCount" class="setting-select">
                                    <option value="5">5 c√¢u</option>
                                    <option value="10" selected>10 c√¢u</option>
                                    <option value="15">15 c√¢u</option>
                                    <option value="20">20 c√¢u</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label for="timeLimit">
                                    <i class="fas fa-clock"></i>
                                    Th·ªùi gian m·ªói c√¢u:
                                </label>
                                <select id="timeLimit" class="setting-select">
                                    <option value="30">30 gi√¢y</option>
                                    <option value="60" selected>60 gi√¢y</option>
                                    <option value="90">90 gi√¢y</option>
                                    <option value="120">120 gi√¢y</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label for="difficulty">
                                    <i class="fas fa-chart-line"></i>
                                    ƒê·ªô kh√≥:
                                </label>
                                <select id="difficulty" class="setting-select">
                                    <option value="easy">üü¢ D·ªÖ</option>
                                    <option value="medium" selected>üü° Trung b√¨nh</option>
                                    <option value="hard">üî¥ Kh√≥</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Settings Preview -->
                        <div class="settings-preview">
                            <div class="preview-item">
                                <span class="preview-label">T·ªïng th·ªùi gian:</span>
                                <span class="preview-value" id="totalTimePreview">10 ph√∫t</span>
                            </div>
                            <div class="preview-item">
                                <span class="preview-label">ƒê·ªô kh√≥ hi·ªán t·∫°i:</span>
                                <span class="preview-value" id="difficultyPreview">üü° Trung b√¨nh</span>
                            </div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button id="startGameBtn" class="start-btn" disabled>
                            <i class="fas fa-play"></i>
                            <span>B·∫Øt ƒë·∫ßu ch∆°i</span>
                            <div class="btn-shine"></div>
                        </button>
                        
                        <a href="lab.html" class="lab-btn">
                            <i class="fas fa-flask"></i>
                            <span>Ph√≤ng Lab</span>
                            <div class="btn-shine"></div>
                            <div class="lab-badge">NEW</div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Game Screen -->
            <div id="gameScreen" class="screen">
                <div class="game-header">
                    <div class="game-info">
                        <div class="question-counter">
                            <i class="fas fa-list-ol"></i>
                            <span id="questionNumber">1</span> / <span id="totalQuestions">10</span>
                        </div>
                        <div class="timer">
                            <i class="fas fa-clock"></i>
                            <span id="timer">60</span>s
                        </div>
                        <div class="score-display">
                            <i class="fas fa-star"></i>
                            <span id="currentScore">0</span> ƒëi·ªÉm
                        </div>
                    </div>
                    <div class="difficulty-indicator">
                        <span class="difficulty-badge medium" id="currentDifficulty">üü° Trung b√¨nh</span>
                    </div>
                </div>

                <div class="question-container">
                    <div class="question-content">
                        <div id="questionText" class="question-text">
                            <!-- Question will be loaded here -->
                        </div>
                        <div id="questionImage" class="question-image" style="display: none;">
                            <img src="" alt="Question image">
                        </div>
                    </div>

                    <div id="answerOptions" class="answer-options">
                        <!-- Answer options will be loaded here -->
                    </div>

                    <div class="game-controls">
                        <button id="hintBtn" class="control-btn hint-btn">
                            <i class="fas fa-lightbulb"></i>
                            <span>G·ª£i √Ω</span>
                            <span class="hint-count" id="hintCount">3</span>
                        </button>
                        <button id="nextQuestionBtn" class="control-btn next-btn" style="display: none;">
                            <i class="fas fa-arrow-right"></i>
                            <span>C√¢u ti·∫øp theo</span>
                        </button>
                        <div class="game-stats">
                            <div class="stat-item">
                                <i class="fas fa-check-circle"></i>
                                <span id="correctCount">0</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-times-circle"></i>
                                <span id="wrongCount">0</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-fire"></i>
                                <span id="streakCount">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-bar">
                        <div id="progressBar" class="progress-fill"></div>
                    </div>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="screen">
                <div class="results-content">
                    <div class="results-header">
                        <h2>K·∫øt qu·∫£ game</h2>
                        <div class="final-score">
                            <span id="finalScore">0</span>
                            <small>ƒëi·ªÉm</small>
                        </div>
                    </div>

                    <div class="results-stats">
                        <div class="stat-item">
                            <i class="fas fa-check-circle"></i>
                            <span class="stat-value" id="correctAnswers">0</span>
                            <span class="stat-label">C√¢u ƒë√∫ng</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-times-circle"></i>
                            <span class="stat-value" id="wrongAnswers">0</span>
                            <span class="stat-label">C√¢u sai</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-fire"></i>
                            <span class="stat-value" id="maxStreak">0</span>
                            <span class="stat-label">Chu·ªói d√†i nh·∫•t</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-clock"></i>
                            <span class="stat-value" id="timeUsed">0</span>
                            <span class="stat-label">Th·ªùi gian</span>
                        </div>
                    </div>

                    <div class="results-actions">
                        <button id="playAgainBtn" class="action-btn primary">
                            <i class="fas fa-redo"></i>
                            <span>Ch∆°i l·∫°i</span>
                        </button>
                        <button id="changeSubjectBtn" class="action-btn secondary">
                            <i class="fas fa-exchange-alt"></i>
                            <span>ƒê·ªïi m√¥n</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Game H·ªçc T·∫≠p. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/data/questions.js?v=1.9"></script>
    <script src="js/core/shuffle.js?v=1.9"></script>
    <script src="js/core/storage.js?v=1.9"></script>
    <script src="js/core/animations.js?v=1.9"></script>
    <script src="js/core/achievements.js?v=1.9"></script>
    <script src="js/core/analytics.js?v=1.9"></script>
    <script src="js/core/ai.js?v=1.9"></script>
    <script src="js/core/question-manager.js?v=1.9"></script>
    <script src="js/core/engine.js?v=1.9"></script>
    <script src="js/modules/math.js?v=1.9"></script>
    <script src="js/modules/physics.js?v=1.9"></script>
    <script src="js/modules/chemistry.js?v=1.9"></script>
    <script src="js/ui/manager.js?v=1.9"></script>
    <script src="js/app.js?v=1.9"></script>
    
    
    <!-- Settings Preview Script -->
    <script>
        // Update settings preview in real-time
        function updateSettingsPreview() {
            const questionCount = parseInt(document.getElementById('questionCount')?.value) || 10;
            const timeLimit = parseInt(document.getElementById('timeLimit')?.value) || 60;
            const difficulty = document.getElementById('difficulty')?.value || 'medium';
            
            // Calculate total time
            const totalSeconds = questionCount * timeLimit;
            const totalMinutes = Math.floor(totalSeconds / 60);
            const remainingSeconds = totalSeconds % 60;
            
            let totalTimeText = '';
            if (totalMinutes > 0) {
                totalTimeText = `${totalMinutes} ph√∫t`;
                if (remainingSeconds > 0) {
                    totalTimeText += ` ${remainingSeconds} gi√¢y`;
                }
            } else {
                totalTimeText = `${totalSeconds} gi√¢y`;
            }
            
            // Update preview
            const totalTimePreview = document.getElementById('totalTimePreview');
            const difficultyPreview = document.getElementById('difficultyPreview');
            
            if (totalTimePreview) {
                totalTimePreview.textContent = totalTimeText;
            }
            
            if (difficultyPreview) {
                const difficultyMap = {
                    'easy': 'üü¢ D·ªÖ',
                    'medium': 'üü° Trung b√¨nh',
                    'hard': 'üî¥ Kh√≥'
                };
                difficultyPreview.textContent = difficultyMap[difficulty] || 'üü° Trung b√¨nh';
            }
        }
        
        // Add event listeners for settings changes
        document.addEventListener('DOMContentLoaded', function() {
            const questionCount = document.getElementById('questionCount');
            const timeLimit = document.getElementById('timeLimit');
            const difficulty = document.getElementById('difficulty');
            
            if (questionCount) {
                questionCount.addEventListener('change', updateSettingsPreview);
            }
            if (timeLimit) {
                timeLimit.addEventListener('change', updateSettingsPreview);
            }
            if (difficulty) {
                difficulty.addEventListener('change', updateSettingsPreview);
            }
            
            // Initial update
            updateSettingsPreview();
        });
    </script>
    
    <!-- Cache Clear Script -->
    <script>
        // Force clear cache
        if ('caches' in window) {
            caches.keys().then(function(names) {
                for (let name of names) {
                    caches.delete(name);
                }
            });
        }
        
        // Clear localStorage if needed
        if (localStorage.getItem('force_clear_cache') === 'true') {
            localStorage.clear();
            localStorage.removeItem('force_clear_cache');
        }
    </script>
    
    <!-- Initialization Script -->
    <script>
        // Global error handling to suppress browser extension warnings
        window.addEventListener('error', function(e) {
            // Suppress runtime.lastError warnings from browser extensions
            if (e.message && e.message.includes('runtime.lastError')) {
                e.preventDefault();
                return false;
            }
        });
        
        // Suppress unhandled promise rejections from extensions
        window.addEventListener('unhandledrejection', function(e) {
            if (e.reason && e.reason.message && e.reason.message.includes('message port')) {
                e.preventDefault();
                return false;
            }
        });
        
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('üîß Service Worker registered successfully:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('üîß Service Worker registration failed:', error);
                    });
            });
        }
        
        // Initialize app when page loads
        window.addEventListener('load', function() {
            console.log('üöÄ Page loaded, initializing app...');
            
            // Debug: Check all modules
            console.log('üîç Debug: Checking modules...');
            console.log('ShuffleEngine:', !!window.ShuffleEngine);
            console.log('StorageManager:', !!window.StorageManager);
            console.log('AnimationManager:', !!window.AnimationManager);
            console.log('AchievementSystem:', !!window.AchievementSystem);
            console.log('GameEngine:', !!window.GameEngine);
            console.log('UIManager:', !!window.UIManager);
            console.log('MathModule:', !!window.MathModule);
            console.log('PhysicsModule:', !!window.PhysicsModule);
            console.log('ChemistryModule:', !!window.ChemistryModule);
            console.log('GameApp:', !!window.GameApp);
            console.log('QUESTIONS_DATA:', !!window.QUESTIONS_DATA);
            
            // Hide loading screen after a short delay
            setTimeout(() => {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
            }, 1000);
            
            // Initialize app
            if (window.GameApp) {
                window.GameApp.initialize().then(() => {
                    console.log('‚úÖ App initialized successfully');
                }).catch((error) => {
                    console.error('‚ùå Failed to initialize app:', error);
                    // Show error message
                    const errorDiv = document.createElement('div');
                    errorDiv.innerHTML = `
                        <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                                     background: #dc3545; color: white; padding: 20px; border-radius: 8px; 
                                     z-index: 10000; text-align: center;">
                            <h3>L·ªói kh·ªüi t·∫°o</h3>
                            <p>${error.message}</p>
                            <button onclick="location.reload()" style="background: white; color: #dc3545; 
                                     border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 10px;">
                                T·∫£i l·∫°i trang
                            </button>
                        </div>
                    `;
                    document.body.appendChild(errorDiv);
                });
            } else {
                console.error('‚ùå GameApp not found');
                // Show error message
                const errorDiv = document.createElement('div');
                errorDiv.innerHTML = `
                    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                                 background: #dc3545; color: white; padding: 20px; border-radius: 8px; 
                                 z-index: 10000; text-align: center;">
                        <h3>L·ªói kh·ªüi t·∫°o</h3>
                        <p>GameApp kh√¥ng ƒë∆∞·ª£c t√¨m th·∫•y</p>
                        <button onclick="location.reload()" style="background: white; color: #dc3545; 
                                 border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 10px;">
                            T·∫£i l·∫°i trang
                        </button>
                    </div>
                `;
                document.body.appendChild(errorDiv);
            }
            
            // Test button functionality
            const testBtn = document.getElementById('testBtn');
            if (testBtn) {
                testBtn.addEventListener('click', function() {
                    console.log('üß™ Test button clicked');
                    
                    // Test basic functionality
                    console.log('üß™ Testing modules...');
                    console.log('GameApp available:', !!window.GameApp);
                    console.log('UIManager available:', !!window.UIManager);
                    console.log('GameEngine available:', !!window.GameEngine);
                    console.log('QuestionDatabase available:', !!window.QuestionDatabase);
                    
                    // Test question generation
                    if (window.MathModule) {
                        const testQuestion = window.MathModule.generateQuestion('thcs', 'easy');
                        console.log('üß™ Test question generated:', testQuestion);
                    }
                    
                    // Test shuffle
                    if (window.ShuffleEngine) {
                        const testArray = [1, 2, 3, 4];
                        const shuffled = window.ShuffleEngine.shuffleArray(testArray);
                        console.log('üß™ Test shuffle:', { original: testArray, shuffled });
                    }
                    
                    alert('Test completed! Check console for results.');
                });
            }
        });
    </script>
    <!-- Navigation Script -->
    <script src="js/navigation.js?v=1.0"></script>
    
    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay">
        <div class="mobile-menu-content">
            <div class="mobile-menu-header">
                <div class="mobile-logo">
                    <i class="fas fa-atom"></i>
                    <span>EduVerse</span>
                </div>
                <button class="mobile-menu-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="mobile-nav">
                <a href="home.html" class="mobile-nav-link">
                    <i class="fas fa-home"></i>
                    <span>Trang ch·ªß</span>
                </a>
                <a href="index.html" class="mobile-nav-link active">
                    <i class="fas fa-gamepad"></i>
                    <span>Game h·ªçc t·∫≠p</span>
                </a>
                <a href="lab.html" class="mobile-nav-link">
                    <i class="fas fa-flask"></i>
                    <span>Ph√≤ng th√≠ nghi·ªám</span>
                </a>
                <a href="research.html" class="mobile-nav-link">
                    <i class="fas fa-search"></i>
                    <span>Nghi√™n c·ª©u khoa h·ªçc</span>
                </a>
            </nav>
        </div>
    </div>
</body>
</html>